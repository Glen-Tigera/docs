---
description: Install Calico Enterprise on a Charmed Kubernetes cluster.
---

import InstallCharmedK8s from '@site/calico-enterprise/_includes/components/InstallCharmedK8s';

# Charmed Kubernetes

## Big picture

Install $[prodname] on a Canonical Charmed Kubernetes cluster.

## Before you begin

**CNI support**

- Calico CNI for networking with $[prodname] network policy

  The geeky details of what you get by default:

  <GeekDetails
    prodname='$[prodname]'
    details='Policy:Calico,IPAM:Calico,CNI:Calico,Overlay:IPIP,Routing:BGP,Datastore:Kubernetes'
  />

:::note

By default, Charmed Kubernetes uses Calico for networking. Other CNI options like Flannel or Canal can be configured using bundle overlays during deployment.

:::

**Required**

- Your cluster meets the [system requirements](requirements.mdx)
- A [Tigera license key and credentials](calico-enterprise.mdx)
- [Install kubectl](https://kubernetes.io/docs/tasks/tools/install-kubectl/) on your workstation
- [Install juju](https://juju.is/docs/juju/install-juju) on your workstation (if managing the cluster directly)
- A [compatible Charmed Kubernetes cluster](../compatibility.mdx#charmed-kubernetes)
- A [compatible Charmed Kubernetes bundle](https://github.com/charmed-kubernetes/bundle/tree/main) configured without a CNI (eg. calico)

:::caution

**Custom bundle file required**

The default Charmed Kubernetes bundle includes a managed calico charm that is unsupported to migrate to $[prodname].

For successful $[prodname] installation with Charmed Kubernetes, we recommend using a custom bundle file without the calico charm instead of using default Charmed Kubernetes bundle directly. This ensures proper configuration and compatibility to install $[prodname] smoothly.

:::

An compatible bundle manifest to successfully install $[prodname] is below:

<details>
<summary>Charmed Kubernetes bundle manifest</summary>

```yaml
description: A highly-available, production-grade Kubernetes cluster.
docs: https://discourse.charmhub.io/t/charmed-kubernetes-bundle/14447
issues: https://bugs.launchpad.net/charmed-kubernetes-bundles
series: jammy
source: https://github.com/charmed-kubernetes/bundle
website: https://ubuntu.com/kubernetes/charmed-k8s
name: charmed-kubernetes
applications:
  containerd:
    charm: containerd
    channel: 1.33/stable
  easyrsa:
    charm: easyrsa
    channel: 1.33/stable
    constraints: arch=amd64 cpu-cores=2 mem=8192 root-disk=16384
    num_units: 1
  etcd:
    charm: etcd
    channel: 1.33/stable
    constraints: arch=amd64 cpu-cores=2 mem=8192 root-disk=16384
    storage:
      data: loop,1,1024M
    num_units: 1
    options:
      channel: 3.4/stable
  kubernetes-control-plane:
    charm: kubernetes-control-plane
    channel: 1.33/stable
    constraints: arch=amd64 cpu-cores=2 mem=8192 root-disk=16384
    num_units: 1
    expose: true
    options:
      channel: 1.33/stable
  kubernetes-worker:
    charm: kubernetes-worker
    channel: 1.33/stable
    constraints: arch=amd64 cpu-cores=2 mem=8192 root-disk=16384
    num_units: 3
    expose: true
    options:
      channel: 1.33/stable
relations:
- - kubernetes-control-plane:kube-control
  - kubernetes-worker:kube-control
- - kubernetes-control-plane:certificates
  - easyrsa:client
- - kubernetes-control-plane:etcd
  - etcd:db
- - kubernetes-worker:certificates
  - easyrsa:client
- - etcd:certificates
  - easyrsa:client
- - containerd:containerd
  - kubernetes-worker:container-runtime
- - containerd:containerd
  - kubernetes-control-plane:container-runtime
```

</details>

Create the Charmed Kubernetes cluster by specifying the bundle file in the `juju deploy` command:

```
juju deploy ./bundle.yaml
```

**Configure cluster for $[prodname]**

Ensure the Charmed Kubernetes model and its applications are stable by running:

```bash
juju wait-for model $modelName --query='life=="alive" && status=="available"'
```

Also ensure the applications and units are active in the model by running:

```bash
juju status
```

You may notice that the `kubernetes-control-plane` and `kubernetes-worker` are in waiting status due to missing CNI. This status can be prevented by ensuring setting `ignore-missing-cni=true` in the `kubernetes-control-plane` and `kubernetes-worker` charms by running:

```bash
juju config kubernetes-control-plane ignore-missing-cni=true
juju config kubernetes-worker ignore-missing-cni=true
```

:::note
- `ignore-missing-cni=true` allows the `kubernetes-control-plane` and `kubernetes-worker` charms to be ready without waiting for a CNI plugin to be installed since $[prodname] will provide its own.
:::

To allow setup of the CNI to be taken care of by $[prodname], the `kubernetes-control-plane` charm also needs to allow privileged pods by running:
```bash
juju config kubernetes-control-plane allow-privileged=true
```

:::note
- `allow-privileged=true` enables privileged containers which are required to let $[prodname] setup the CNI by deploying its own calico-node daemonset
:::

## How to

1. [Install $[prodname]](#install-calico-enterprise)
1. [Install the $[prodname] license](#install-the-calico-enterprise-license)

<InstallCharmedK8s clusterType='standalone' />

## Next steps

- [Configure access to the $[prodname] web console](../../operations/cnx/access-the-manager.mdx)
- [Get started with Kubernetes network policy](../../network-policy/get-started/kubernetes-network-policy.mdx)
- [Get started with $[prodname] network policy](../../network-policy/beginners/calico-network-policy.mdx)
- [Enable default deny for Kubernetes pods](../../network-policy/beginners/kubernetes-default-deny.mdx)

**Additional resources**

- [Charmed Kubernetes documentation](https://ubuntu.com/kubernetes/charmed-k8s/docs/install-manual)
- [Charmed Kubernetes quickstart](https://ubuntu.com/kubernetes/charmed-k8s/docs/quickstart)
- [Juju documentation](https://juju.is/docs)
- [Canonical Kubernetes operations](https://ubuntu.com/kubernetes/docs)
